# OpenVPN server config file
#
# Generated by Chef - local changes will be overwritten

port <%= @port %>
proto <%= @proto %>
<% if @type == "server-bridge" -%>
dev tap<%= @interface_num %>
<% else -%>
dev tun<%= @interface_num %>
<% end -%>
<% @plugins.each do |p| -%>
plugin <%= p %>
<% end -%>
<% if @external_auth -%>
<%= @external_auth %>
<% end -%>
keepalive 10 120
<% if @max_clients -%>
max-clients <%= @max_clients %>
<% end -%>
<% if @max_routes -%>
max-routes <%= @max_routes %>
<% end -%>
comp-lzo
local <%= @local %>
<% if @reneg_sec -%>
reneg-sec <%= @reneg_sec %>
<% end -%>
<% if @routes -%>
<% @routes.each do |route| -%>
<%= route %>
<% end -%>
<% end -%>
<% if @script_security > 1 -%>
up /etc/openvpn/server.up.sh
<% end -%>

<% if @dhcp_dns -%>
push "dhcp-option DNS <%= @dhcp_dns %>"
<% end -%>
<% if @dhcp_domain -%>
push "dhcp-option DOMAIN <%= @dhcp_domain %>"
<% end -%>
<% if @duplicate_cn -%>
duplicate-cn
<% end -%>
<% if @client_subnet_route -%>
client-config-dir ccd
route <%= @client_subnet_route %>
<% end -%>

# Keys and certificates.
ca   <%= @key_dir %>/ca.crt
key  <%= @key_dir %>/server.key # This file should be kept secret.
cert <%= @key_dir %>/server.crt
dh   <%= @key_dir %>/dh<%= @key_size %>.pem
<% if @tls_key -%>
tls-auth <%= @tls_key %> 0
<% end -%>

ifconfig-pool-persist /etc/openvpn/ipp.txt

<% if @type == "server" -%>
<%= @type %> <%= @subnet %> <%= @netmask %>
<% if @topology -%>
topology <%= @topology %>
<% end -%>
<% end -%>
user <%= @user %>
group <%= @group %>

# avoid accessing certain resources on restart
persist-key
persist-tun

# current client connections
status <%= @status_log %>

# logging settings.
log-append  <%= @log %>
verb <%= @verb %>  # don't spam the log with messages.
mute <%= @mute %>  # suppress identical messages > 10 occurances.

script-security <%= @script_security %>
