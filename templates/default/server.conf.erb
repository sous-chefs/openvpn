# OpenVPN server config file
#
# Generated by Chef - local changes will be overwritten

port <%= node['openvpn']['port'] %>
proto <%= node['openvpn']['proto'] %>
<% if node['openvpn']['type'] == 'server-bridge' -%>
dev tap
<% else -%>
dev tun
<% end -%>
keepalive 10 120
comp-lzo
local <%= node['openvpn']['local'] %>
<% if node['openvpn']['routes'] -%>
<% node['openvpn']['routes'].each do |route| -%>
<%= route %>
<% end -%>
<% end -%>
<% if node['openvpn']['script_security'] > 1 -%>
up /etc/openvpn/server.up.sh
<% end -%>

# Keys and certificates.
ca         <%= node['openvpn']['key_dir'] %>/ca.crt
<% if node['openvpn']['tls'] == true -%>
tls-auth   <%= node['openvpn']['key_dir'] %>/ta.key 0
<% end -%>
key        <%= node['openvpn']['key_dir'] %>/server.key # This file should be kept secret.
cert       <%= node['openvpn']['key_dir'] %>/server.crt
dh         <%= node['openvpn']['key_dir'] %>/dh<%= node["openvpn"]["key"]["size"] %>.pem

ifconfig-pool-persist /etc/openvpn/ipp.txt

<% if node['openvpn']['type'] == 'server' -%>
<%= node['openvpn']['type'] %> <%= node['openvpn']['subnet'] %> <%= node['openvpn']['netmask'] %>
<% end -%>

user <%= node['openvpn']['user'] %>
group <%= node['openvpn']['group'] %>

# avoid accessing certain resources on restart
persist-key
persist-tun

# current client connections
status /etc/openvpn/openvpn-status.log

# logging settings.
log-append  <%= node['openvpn']['log'] %>
verb 1  # don't spam the log with messages.
mute 10 # suppress identical messages > 10 occurances.

script-security <%= node['openvpn']['script_security'] %>
